# üöÄ Entrypoint Scripts Documentation

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö entrypoint —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∑–∞–ø—É—Å–∫–∞ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏.

## üìã –°–ø–∏—Å–æ–∫ Entrypoint'–æ–≤

### 1. **–û—Å–Ω–æ–≤–Ω–æ–π Backend Entrypoint**
**–§–∞–π–ª:** `backend/docker-entrypoint.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### –§—É–Ω–∫—Ü–∏–∏:
- ‚úÖ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL –∏ Redis
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ dev-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ development —Ä–µ–∂–∏–º–µ
- ‚úÖ –ó–∞–ø—É—Å–∫ Uvicorn (development) –∏–ª–∏ Gunicorn (production)
- ‚úÖ –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
# Development (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
make dev

# –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫
docker-compose up backend
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `ENVIRONMENT` - —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (development/production)
- `DEBUG` - —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
- `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- `REDIS_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis

---

### 2. **Production Entrypoint**
**–§–∞–π–ª:** `scripts/production-entrypoint.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è production

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- üîí **–í–∞–ª–∏–¥–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚ö° **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –¥–ª—è production
- üè• **Health checks** –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üîÑ **Graceful shutdown** –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤
- üöÄ **Gunicorn** —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
# Production –∑–∞–ø—É—Å–∫
make prod

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
docker-compose --profile production up backend-prod
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Gunicorn:
```bash
WORKERS=4                    # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ worker'–æ–≤
WORKER_CONNECTIONS=1000      # –°–æ–µ–¥–∏–Ω–µ–Ω–∏–π –Ω–∞ worker
MAX_REQUESTS=1000           # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ worker'–∞ –ø–æ—Å–ª–µ N –∑–∞–ø—Ä–æ—Å–æ–≤
TIMEOUT=30                  # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
```

---

### 3. **Test Entrypoint**
**–§–∞–π–ª:** `scripts/test-entrypoint.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –§—É–Ω–∫—Ü–∏–∏:
- üß™ **–¢–µ—Å—Ç–æ–≤–∞—è –ë–î** - —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- üîç **Code Quality** - –ª–∏–Ω—Ç–∏–Ω–≥, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, type checking
- üìä **Coverage** - –æ—Ç—á—ë—Ç—ã –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∫–æ–¥–∞
- üßπ **Cleanup** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–æ–≤

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
# –ü–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã
make test

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
make test-cov

# –¢–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
make test-unit

# –ö–∞—Å—Ç–æ–º–Ω—ã–π –∑–∞–ø—É—Å–∫
docker-compose --profile testing run --rm backend-test --coverage --verbose
```

#### –û–ø—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:
```bash
--coverage      # –í–∫–ª—é—á–∏—Ç—å –æ—Ç—á—ë—Ç –æ –ø–æ–∫—Ä—ã—Ç–∏–∏
--verbose       # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
--skip-quality  # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
--keep-db       # –ù–µ —É–¥–∞–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
--path <path>   # –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã
```

---

### 4. **Database Initialization**
**–§–∞–π–ª:** `scripts/init-db.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö

#### –§—É–Ω–∫—Ü–∏–∏:
- üóÑÔ∏è **–°–æ–∑–¥–∞–Ω–∏–µ –ë–î** –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- üìù **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL** –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- üë• **–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ** –¥–ª—è development –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: `admin@example.com`, `user@example.com`
- –ü–∞—Ä–æ–ª—å –¥–ª—è –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: `password123`
- –î–µ–º–æ-–ø–æ–∏–Ω—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
make init-db

# –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
make reset-db
```

---

### 5. **Backup Entrypoint**
**–§–∞–π–ª:** `scripts/backup.sh`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- üíæ **–ü–æ–ª–Ω—ã–π backup** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- üìã **Schema-only** backup
- üóÇÔ∏è **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã** –æ—Ç–¥–µ–ª—å–Ω–æ
- üìù **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** backup'–∞
- üóúÔ∏è **–°–∂–∞—Ç–∏–µ** –∞—Ä—Ö–∏–≤–æ–≤
- üßπ **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞** —Å—Ç–∞—Ä—ã—Ö backup'–æ–≤
- ‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

#### –§–æ—Ä–º–∞—Ç—ã backup'–æ–≤:
- `database.sql` - –ø–æ–ª–Ω—ã–π SQL dump
- `database.sql.custom` - PostgreSQL custom format
- `schema.sql` - —Ç–æ–ª—å–∫–æ —Å—Ö–µ–º–∞
- `table_*.sql` - –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `metadata.json` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ backup'–µ

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```bash
# –ü–æ–ª–Ω—ã–π backup
make backup

# –ë—ã—Å—Ç—Ä—ã–π backup –ë–î
make backup-quick

# Backup —Ñ–∞–π–ª–æ–≤
make backup-files

# –ö–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø—Ü–∏–∏
docker-compose --profile backup run --rm backup --no-compress --retention 14
```

#### –û–ø—Ü–∏–∏:
```bash
--no-compress   # –ù–µ —Å–∂–∏–º–∞—Ç—å backup
--no-cleanup    # –ù–µ —É–¥–∞–ª—è—Ç—å —Å—Ç–∞—Ä—ã–µ backup'—ã
--retention N   # –•—Ä–∞–Ω–∏—Ç—å backup'—ã N –¥–Ω–µ–π
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û–±—â–∏–µ:
```env
ENVIRONMENT=development|production|test
DEBUG=true|false
DATABASE_URL=postgresql://user:pass@host:port/db
REDIS_URL=redis://host:port
SECRET_KEY=your-secret-key
```

#### Production:
```env
WORKERS=4
MAX_REQUESTS=1000
TIMEOUT=30
ALLOWED_HOSTS=["yourdomain.com"]
SSL_CERT_PATH=/path/to/cert.pem
SSL_KEY_PATH=/path/to/key.pem
```

#### Backup:
```env
BACKUP_RETENTION_DAYS=7
COMPRESS_BACKUP=true
```

### Health Checks

–í—Å–µ entrypoint'—ã –≤–∫–ª—é—á–∞—é—Ç health checks:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ make
make health
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑:
```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
make logs

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker-compose logs -f backend

# Production –ª–æ–≥–∏
docker-compose --profile production logs -f backend-prod
```

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Development –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
make setup

# –¢–æ–ª—å–∫–æ backend
make dev

# –° –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
make dev && make init-db
```

### Testing
```bash
# –ü–æ–ª–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º –∫–æ–¥–∞
make test

# –ë—ã—Å—Ç—Ä—ã–µ unit —Ç–µ—Å—Ç—ã
make test-unit

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
make test-integration
```

### Production –¥–µ–ø–ª–æ–π
```bash
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
cp .env.example .env
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env –¥–ª—è production

# –ó–∞–ø—É—Å–∫
make prod

# –ò–ª–∏ —Å Nginx
docker-compose --profile production up -d
```

### Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# –†–µ–≥—É–ª—è—Ä–Ω—ã–π backup
make backup

# –ë—ã—Å—Ç—Ä—ã–π backup –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
make backup-quick

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (–ø—Ä–∏–º–µ—Ä)
docker-compose exec db psql -U postgres -d queue_app < backups/backup.sql
```

---

## üõ†Ô∏è Troubleshooting

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### Entrypoint –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la backend/docker-entrypoint.sh
ls -la scripts/*.sh

# –ò—Å–ø—Ä–∞–≤—å—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
chmod +x backend/docker-entrypoint.sh
chmod +x scripts/*.sh
```

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
make ps

# –õ–æ–≥–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose logs db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
make restart
```

#### –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç:
```bash
# –û—á–∏—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É
docker-compose --profile testing down -v

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
make test
```

### –û—Ç–ª–∞–¥–∫–∞ entrypoint'–æ–≤

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –¥–æ–±–∞–≤—å—Ç–µ `set -x` –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞:
```bash
#!/bin/bash
set -e
set -x  # –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](../QUICK_START.md)
- [–û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](../README.md)
- [Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](../docker-compose.yml)
- [Makefile –∫–æ–º–∞–Ω–¥—ã](../Makefile)

---

**–í—Å–µ entrypoint'—ã —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –∏ —É–¥–æ–±—Å—Ç–≤–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!** üéâ